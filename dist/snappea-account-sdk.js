!function(a){var b=window.$.Deferred,c=window.$.ajax;$.ajaxSetup&&$.ajaxSetup({xhrFields:{withCredentials:!0}});var d=function(a,b){if(!b)return a;var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},e={ajax:{error:-1,msg:"请求失败，请检查网络连接状况。"},missingParameters:{error:-2,msg:"参数不全"}},f=function(){var a,b,c={},d=window.location.search.substr(1).split("&");if(""===d[0])return c;for(a=0;a<d.length;a++)b=d[a].split("="),c[b[0].toLowerCase()]=decodeURIComponent(b[1]);return c}(),g={},h=function(a){return f[a.toLowerCase()]};g.getParam=h;var i={from:{aliOpen:"aliopen"},host:"//wdj.account.test.uc.cn",mainHost:"//openplatform.dev.uae.uc.cn"},j=h("from")===i.from.aliOpen?i.host:"https://account.wandoujia.com",k=h("from")===i.from.aliOpen?i.host:"http://www.wandoujia.com/api/account",l="/v4/api",m=navigator.userAgent.toLowerCase().indexOf("msie")>-1,n=(m?k:j)+l,o={login:n+"/login",logout:n+"/logout",captcha:n+"/seccode",reg:n+"/register",checkUsername:n+"/isUsernameExisted",checkUserLogin:n+"/profile",checkUserLoginWithAuth:n+"/profile_with_auth",findPwd:n+"/findpassword",checkCode:n+"/checkcode",resetPwd:n+"/resetpassword",modifyPwd:n+"/profile/password",checkPasscode:n+"/checkpasscode",modifyPwdByCode:n+"/modifypassword",completeProfile:n+"/completeProfile",activate:n+"/activation/initialization",activateValid:n+"/activation/validation",unbindThirdParty:n+"/social/unbind",avatar:n+"/avatar",confirm:n+"/account/confirm"},p={loginWithThirdParty:j+"/web/oauth2/{1}/login"},q={},r=!1,s={};s.CAPTCHA=o.captcha,s.loginAsync=function(a,f){var g=new b;return a=a||{},f=f||{},a.username&&a.password?c({type:"POST",dataType:"json",url:o.login,data:d({username:a.username,password:a.password,seccode:a.seccode||""},f),success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),r=!0,q=a.member,g.resolve(a.member)):1000004===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}):g.reject(e.missingParameters),g.promise()},s.isLogined=function(){return r},s.getUserInfo=function(){return q||{}},s.logoutAsync=function(a){var d=new b;a=a||{};var f=!!a.jsonp;return delete a.jsonp,c({type:"POST",dataType:f?"jsonp":"json",url:o.logout,data:a,crossDomain:f?!0:void 0,success:function(a){0===a.error?(r=!1,q=void 0,d.resolve(a)):d.reject(a)},error:function(a){4===a.readyState&&d.reject(a.responseJSON||{}),d.reject(e.ajax)}}),d.promise()},s.regAsync=function(a,f){var g=new b;return a=a||{},f=f||{},a.username&&(a.oneKeyRegister||a.password)?c({type:"POST",dataType:"json",url:o.reg,data:d({username:a.username,password:a.password,oneKeyRegister:a.oneKeyRegister||!1,nick:a.nickname||"",seccode:a.seccode||""},f),success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),r=!0,q=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}):g.reject(e.missingParameters),g.promise()},s.checkUsernameAsync=function(a,f){var g=new b;return f=f||{},void 0===a?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.checkUsername,data:d({username:a},f),success:function(a){g.resolve(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.checkUserLoginAsync=function(a){var d=new b;a=a||{};var e=!!a.jsonp;return delete a.jsonp,c({type:"GET",dataType:e?"jsonp":"json",url:o.checkUserLogin,data:a,crossDomain:e?!0:void 0,success:function(a){0===a.error?(r=!0,q=a.member,d.resolve(!0)):(r=!1,q=void 0,d.reject(!1))},error:function(){d.reject(!1)}}),d.promise()},s.checkUserLoginWithAuthAsync=function(a){var d=new b;a=a||{};var f=!!a.jsonp;return delete a.jsonp,c({type:"GET",dataType:f?"jsonp":"json",url:o.checkUserLoginWithAuth,data:a,crossDomain:f?!0:void 0,success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),r=!0,q=a.member,d.resolve(a.member)):(r=!1,q=void 0,d.reject(a))},error:function(a){4===a.readyState&&d.reject(a.responseJSON||{}),d.reject(e.ajax)}}),d.promise()},s.findPwdAsync=function(a,f){var g=new b;return f=f||{},void 0===a?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.findPwd,data:d({username:a},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.checkCodeAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.username||void 0===a.passcode?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.checkCode,data:d({username:a.username,passcode:a.passcode},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.resetPwdAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.username||void 0===a.passcode||void 0===a.password?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.resetPwd,data:d({username:a.username,passcode:a.passcode,password:a.password,repeatedpassword:a.password},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.modifyPwdAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.password||void 0===a.newpassword?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.modifyPwd,data:d({oldpassword:a.password,newpassword:a.newpassword},f),success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),q=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.checkPasscodeAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.passcode?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.checkPasscode,data:d({passcode:a.passcode},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.modifyPwdByCodeAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.username||void 0===a.passcode||void 0===a.password?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.modifyPwdByCode,data:d({username:a.username,passcode:a.passcode,password:a.password},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.updateProfileAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.nickname?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.completeProfile,data:d({nick:a.nickname},f),success:function(a){0===a.error?(q=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.activateAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.type?g.reject(e.missingParameters):c({type:"GET",dataType:"json",url:o.activate,data:d({type:a.type,account:a.account},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.activateValidAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.code?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.activateValid,data:d({code:a.code,type:"sms"},f),success:function(a){0===a.error?(q.telephoneValidated=!0,g.resolve(a)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.uploadAvatarAsync=function(d,f){var g=new b;d=d||{},f=f||{};var h,i;if(void 0===d.file)g.reject(e.missingParameters);else{h=new a.FormData,h.append("file",d.file);for(i in f)f.hasOwnProperty(i)&&h.append(i,f[i]);c({type:"POST",dataType:"json",url:o.avatar,data:h,processData:!1,contentType:!1,success:function(a){0===a.error?(q=a.member,g.resolve(a.member.avatar)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}})}return g.promise()},s.unbindThirdPartyAsync=function(a,f){var g=new b;a=a||{},f=f||{};var h={weibo:"1",sina:"1",qq:"2",renren:"3"};return void 0===a.platform||void 0===h[a.platform]?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.unbindThirdParty,data:d({platid:h[a.platform]},f),success:function(a){0===a.error?(q=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.confirmAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.code?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:o.confirm,data:d({code:a.code},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},s.isEmail=function(a){var b=/^\s*?(.+)@(.+?)\.(.+?)\s*$/;return b.test(a)},s.isPhoneNumber=function(a){var b=/^1[34578]\d{9}$/;return b.test(a)},s.loginWithThirdParty=function(b){b=b||{},b.callback=b.callback||"http://www.wandoujia.com/";var c={weibo:"sina",sina:"sina",renren:"renren",qq:"qq"},d=c[b.platform];delete b.platform;var e=b.onclose||function(){};delete b.onclose;var f,g=[];for(f in b)b.hasOwnProperty(f)&&g.push(f+"="+a.encodeURIComponent(b[f]));var h=p.loginWithThirdParty.replace("{1}",d);if(g.length>0&&(h=h+"?"+g.join("&")),b.popup)var i=window.open(h,"loginWithThirdParty","width=650, height=480"),j=setInterval(function(){i.closed&&(clearInterval(j),e.call(this))},200);else a.location.href=h};var t=a.SnapPea||{};t.Account=s,t.Utils=g,t.AliOpen=i,a.SnapPea=t}(this);